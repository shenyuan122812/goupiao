{"remainingRequest":"D:\\项目\\movie\\vue-app\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\项目\\movie\\vue-app\\src\\views\\me\\Cart.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\项目\\movie\\vue-app\\src\\views\\me\\Cart.vue","mtime":1617329480321},{"path":"D:\\项目\\movie\\vue-app\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\项目\\movie\\vue-app\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7RGVsZXRlQ2FydEJ5SWQsIExpc3RDYXJ0c30gZnJvbSAiQC9hcGkvY2FydCIKaW1wb3J0IHtDcmVhdGVPcmRlcn0gZnJvbSAiQC9hcGkvb3JkZXIiOwoKZXhwb3J0IGRlZmF1bHQgewogICAgZGF0YSgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBpOiAwLAogICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSwKICAgICAgICAgICAgY2VudGVyRGlhbG9nVmlzaWJsZTogZmFsc2UsCiAgICAgICAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICAgICAgICBwcmljZTogMCwKICAgICAgICAgICAgc2VsZWN0TGlzdDogW10sCiAgICAgICAgICAgIGNoZWNrQWxsOiBmYWxzZSwKICAgICAgICAgICAgY2FydExpc3Q6IFtdLAogICAgICAgICAgICB1aWQ6IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJ1aWQiKSwKICAgICAgICB9CiAgICB9LAoKICAgIG1vdW50ZWQoKSB7CiAgICAgICAgdGhpcy5sb2FkQ2FydHMoKQogICAgfSwKCiAgICBtZXRob2RzOiB7CgogICAgICAgIGxvYWRDYXJ0cygpIHsKICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgTGlzdENhcnRzKHRoaXMudWlkKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNhcnRMaXN0ID0gcmVzLmRhdGEKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY2FydExpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RMaXN0W2ldID0ge2NoZWNrZWQ6IGZhbHNlLCBjYXJ0OiB0aGlzLmNhcnRMaXN0W2ldLmNhcnR9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICB9LCA3MDApCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKCiAgICAgICAgaGFuZGxlQ2hlY2soKSB7CiAgICAgICAgICAgIHRoaXMuY2hlY2tPdXQoKQogICAgICAgIH0sCgogICAgICAgIGhhbmRsZUNoZWNrQWxsKCkgewogICAgICAgICAgICBpZiAodGhpcy5jaGVja0FsbCkgewogICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VBbGxDaGVja2VkKHRydWUpCiAgICAgICAgICAgICAgICB0aGlzLmNoZWNrT3V0KCkKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlQWxsQ2hlY2tlZChmYWxzZSkKICAgICAgICAgICAgICAgIHRoaXMucHJpY2UgPSAwCiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICBjaGFuZ2VBbGxDaGVja2VkKHN0YXR1cykgewogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2VsZWN0TGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RMaXN0W2ldLmNoZWNrZWQgPSBzdGF0dXMKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIGNoZWNrT3V0KCkgewogICAgICAgICAgICB0aGlzLnByaWNlID0gMAogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2VsZWN0TGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0TGlzdFtpXS5jaGVja2VkKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmljZSArPSB0aGlzLnNlbGVjdExpc3RbaV0uY2FydC5wcmljZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgaGFuZGxlRGVsZXRlKGluZGV4KSB7CiAgICAgICAgICAgIERlbGV0ZUNhcnRCeUlkKHRoaXMuY2FydExpc3RbaW5kZXhdLmNhcnQuaWQpLnRoZW4ocmVzID0+IHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcykKICAgICAgICAgICAgICAgIGlmIChyZXMuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FydExpc3Quc3BsaWNlKGluZGV4LCAxKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0sCgogICAgICAgIHN1Ym1pdENhcnQoKSB7CiAgICAgICAgICAgIHRoaXMuJGNvbmZpcm0oJ+ivt+aCqOS7lOe7huehruiupOiuouWNlemHkemineS4uicgKyB0aGlzLnByaWNlICsgJ+WFgywg5piv5ZCm57un57utPycsICfmj5DnpLonLCB7CiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+ehruiupOaUr+S7mCcsCiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raI5pSv5LuYJywKICAgICAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJywKICAgICAgICAgICAgICAgIGNlbnRlcjogdHJ1ZQogICAgICAgICAgICB9KS50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5zZWxlY3RMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0TGlzdFtpXS5jaGVja2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VsZWN0TGlzdFtpXS5jYXJ0LnN0YXR1cyA9IDIKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jZW50ZXJEaWFsb2dWaXNpYmxlID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmkgPSBpCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5jYXRjaCgoKSA9PiB7CiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2VsZWN0TGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdExpc3RbaV0uY2hlY2tlZCkgewogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdExpc3RbaV0uY2FydC5zdGF0dXMgPSAwCiAgICAgICAgICAgICAgICAgICAgICAgIENyZWF0ZU9yZGVyKHRoaXMuc2VsZWN0TGlzdFtpXS5jYXJ0KS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWxldGVDYXJ0QnlJZCh0aGlzLnNlbGVjdExpc3RbaV0uY2FydC5pZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3dhcm5pbmcnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAn55So5oi35bey5Y+W5raI5pSv5LuYLCDor7fmgqjliY3lvoDmiJHnmoTorqLljZXov5vooYzmlK/ku5gnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2FkQ2FydHMoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSwKCiAgICAgICAgc3VibWl0UGF5KCkgewogICAgICAgICAgICBjb25zdCBpID0gdGhpcy5pCiAgICAgICAgICAgIENyZWF0ZU9yZGVyKHRoaXMuc2VsZWN0TGlzdFtpXS5jYXJ0KS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgICBpZiAocmVzLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNlbnRlckRpYWxvZ1Zpc2libGUgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIERlbGV0ZUNhcnRCeUlkKHRoaXMuc2VsZWN0TGlzdFtpXS5jYXJ0LmlkKQogICAgICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsCiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICfmga3llpzkvaDmlK/ku5jmiJDlip8hJwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHRoaXMubG9hZENhcnRzKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICB9LAoKICAgIH0sCgp9Cg=="},{"version":3,"sources":["Cart.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4DA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA","file":"Cart.vue","sourceRoot":"src/views/me","sourcesContent":["<template>\r\n    <div style=\"width: 100%\">\r\n        <h3 style=\"letter-spacing: 1px;font-weight: 400;padding-bottom: 20px\">购物车</h3>\r\n\r\n        <div v-loading=\"loading\">\r\n\r\n            <el-card v-for=\"(item, index) in cartList\" :key=\"index\" class=\"box-card\">\r\n                <div>\r\n                    <div style=\"float: left;line-height: 100px;padding-right: 20px\">\r\n                        <el-checkbox @change=\"handleCheck\" v-model=\"selectList[index].checked\"></el-checkbox>\r\n                    </div>\r\n                    <img class=\"item-film-img\" alt=\"\" src=\"../../assets/img/film.png\"/>\r\n                    <div style=\"float: left;\">\r\n                        <div class=\"item-film-name\">《{{ item.film.name }}》</div>\r\n                        <div class=\"item-film-seat\">座位 : {{ item.cart.seats }}</div>\r\n                        <div class=\"item-film-seat\">手机号码 : {{ item.cart.phone }}</div>\r\n                        <div class=\"item-film-time\">开场时间 :\r\n                            <span style=\"color: red\">{{ item.arrangement.date }} - {{ item.arrangement.startTime }}</span>\r\n                        </div>\r\n                    </div>\r\n                    <div style=\"float: right;color: #f34d41;letter-spacing: 2px; line-height: 100px;padding-right: 5px\">\r\n                        ￥{{ item.cart.price }}\r\n                        <el-button @click=\"handleDelete(index)\"\r\n                                   type=\"text\"\r\n                                   style=\"color: red;padding-left: 50px\"\r\n                                   icon=\"el-icon-delete\">删除\r\n                        </el-button>\r\n                    </div>\r\n                </div>\r\n            </el-card>\r\n\r\n            <div v-if=\"cartList.length !==0\" style=\"height: 60px;background: #91949c\">\r\n                <div>\r\n                    <div style=\"float: left;line-height: 60px;padding: 0 20px;font-size: 14px\">\r\n                        <el-checkbox @change=\"handleCheckAll\" v-model=\"checkAll\">全 选</el-checkbox>\r\n                    </div>\r\n                    <el-button @click=\"submitCart\" type=\"text\" class=\"sub-btn\">全部结算</el-button>\r\n                    <div class=\"order-footer1\">合计 : ￥{{ price }}</div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <el-dialog\r\n                title=\"扫码支付\"\r\n                :show-close=\"false\"\r\n                width=\"30%\"\r\n                :visible.sync=\"centerDialogVisible\"\r\n        >\r\n            <div>\r\n                <img class=\"c-img\" src=\"../../assets/img/c.jpeg\" alt=\"\">\r\n            </div>\r\n            <span slot=\"footer\" class=\"dialog-footer\">\r\n    <el-button type=\"primary\" @click=\"submitPay\">支 付 成 功</el-button>\r\n  </span>\r\n        </el-dialog>\r\n\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import {DeleteCartById, ListCarts} from \"@/api/cart\"\r\n    import {CreateOrder} from \"@/api/order\";\r\n\r\n    export default {\r\n        data() {\r\n            return {\r\n                i: 0,\r\n                success: false,\r\n                centerDialogVisible: false,\r\n                loading: false,\r\n                price: 0,\r\n                selectList: [],\r\n                checkAll: false,\r\n                cartList: [],\r\n                uid: localStorage.getItem(\"uid\"),\r\n            }\r\n        },\r\n\r\n        mounted() {\r\n            this.loadCarts()\r\n        },\r\n\r\n        methods: {\r\n\r\n            loadCarts() {\r\n                this.loading = true;\r\n                ListCarts(this.uid).then(res => {\r\n                    setTimeout(() => {\r\n                        this.cartList = res.data\r\n                        for (let i = 0; i < this.cartList.length; i++) {\r\n                            this.selectList[i] = {checked: false, cart: this.cartList[i].cart}\r\n                        }\r\n                        this.loading = false\r\n                    }, 700)\r\n                })\r\n            },\r\n\r\n            handleCheck() {\r\n                this.checkOut()\r\n            },\r\n\r\n            handleCheckAll() {\r\n                if (this.checkAll) {\r\n                    this.changeAllChecked(true)\r\n                    this.checkOut()\r\n                } else {\r\n                    this.changeAllChecked(false)\r\n                    this.price = 0\r\n                }\r\n            },\r\n\r\n            changeAllChecked(status) {\r\n                for (let i = 0; i < this.selectList.length; i++) {\r\n                    this.selectList[i].checked = status\r\n                }\r\n            },\r\n\r\n            checkOut() {\r\n                this.price = 0\r\n                for (let i = 0; i < this.selectList.length; i++) {\r\n                    if (this.selectList[i].checked) {\r\n                        this.price += this.selectList[i].cart.price\r\n                    }\r\n                }\r\n            },\r\n\r\n            handleDelete(index) {\r\n                DeleteCartById(this.cartList[index].cart.id).then(res => {\r\n                    console.log(res)\r\n                    if (res.success) {\r\n                        this.cartList.splice(index, 1)\r\n                    }\r\n                })\r\n            },\r\n\r\n            submitCart() {\r\n                this.$confirm('请您仔细确认订单金额为' + this.price + '元, 是否继续?', '提示', {\r\n                    confirmButtonText: '确认支付',\r\n                    cancelButtonText: '取消支付',\r\n                    type: 'success',\r\n                    center: true\r\n                }).then(() => {\r\n                    for (let i = 0; i < this.selectList.length; i++) {\r\n                        if (this.selectList[i].checked) {\r\n                            this.selectList[i].cart.status = 2\r\n                            this.centerDialogVisible = true\r\n                            this.i = i\r\n                        }\r\n                    }\r\n                }).catch(() => {\r\n                    for (let i = 0; i < this.selectList.length; i++) {\r\n                        if (this.selectList[i].checked) {\r\n                            this.selectList[i].cart.status = 0\r\n                            CreateOrder(this.selectList[i].cart).then(res => {\r\n                                if (res.success) {\r\n                                    DeleteCartById(this.selectList[i].cart.id)\r\n                                    this.$message({\r\n                                        type: 'warning',\r\n                                        message: '用户已取消支付, 请您前往我的订单进行支付'\r\n                                    });\r\n                                    this.loadCarts()\r\n                                }\r\n                            })\r\n                        }\r\n                    }\r\n                });\r\n            },\r\n\r\n            submitPay() {\r\n                const i = this.i\r\n                CreateOrder(this.selectList[i].cart).then(res => {\r\n                    if (res.success) {\r\n                        this.centerDialogVisible = false\r\n                        DeleteCartById(this.selectList[i].cart.id)\r\n                        this.$message({\r\n                            type: 'success',\r\n                            message: '恭喜你支付成功!'\r\n                        });\r\n                        this.loadCarts()\r\n                    }\r\n                })\r\n            },\r\n\r\n        },\r\n\r\n    }\r\n</script>\r\n\r\n<style scoped>\r\n\r\n    .box-card {\r\n        margin-bottom: 5px;\r\n    }\r\n\r\n    >>> .el-card__header {\r\n        background: #C0C4CC;\r\n    }\r\n\r\n    .item-film-img {\r\n        float: left;\r\n        width: 80px;\r\n        height: 100px;\r\n        padding-bottom: 20px;\r\n        padding-right: 10px;\r\n    }\r\n\r\n    .item-film-name {\r\n        letter-spacing: 2px;\r\n        font-weight: 500;\r\n        font-size: 18px;\r\n        padding-bottom: 13px;\r\n    }\r\n\r\n    .item-film-seat {\r\n        letter-spacing: 1px;\r\n        font-size: 12px;\r\n        padding-bottom: 8px;\r\n        padding-left: 10px;\r\n        color: #91949c;\r\n    }\r\n\r\n\r\n    .item-film-time {\r\n        font-size: 12px;\r\n        padding-left: 10px;\r\n        letter-spacing: 1px;\r\n        color: #91949c;\r\n    }\r\n\r\n    .c-img {\r\n        width: 100%;\r\n        height: 100%;\r\n    }\r\n\r\n    .sub-btn {\r\n        float: right;\r\n        color: #000000;\r\n        height: 60px;\r\n        width: 120px;\r\n        background: #f34d41;\r\n        letter-spacing: 2px;\r\n        line-height: 33px;\r\n        text-align: center;\r\n        font-weight: 500;\r\n        font-size: 18px;\r\n    }\r\n\r\n    .order-footer1 {\r\n        float: right;\r\n        line-height: 60px;\r\n        padding-right: 40px;\r\n    }\r\n\r\n    a {\r\n        color: #333333;\r\n    }\r\n\r\n    .di {\r\n        text-align: center;\r\n        font-size: 20px;\r\n        letter-spacing: 3px;\r\n        font-weight: bold;\r\n        padding-top: 10px;\r\n    }\r\n</style>"]}]}